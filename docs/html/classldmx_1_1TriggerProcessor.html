<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LDMX Software: ldmx::TriggerProcessor Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><b>ldmx</b>::<a class="el" href="classldmx_1_1TriggerProcessor.html">TriggerProcessor</a>
  </div>
</div>
<div class="contents">
<h1>ldmx::TriggerProcessor Class Reference</h1><!-- doxytag: class="ldmx::TriggerProcessor" --><!-- doxytag: inherits="ldmx::Producer" -->
<p>Provides a trigger decision for recon using a <a class="el" href="classldmx_1_1TriggerResult.html" title="Represents the trigger decision (pass/fail) for reconstruction.">TriggerResult</a> object.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="TriggerProcessor_8h_source.html">TriggerProcessor.h</a>&gt;</code></p>

<p><a href="classldmx_1_1TriggerProcessor-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1TriggerProcessor.html#af939d94bda95b61752fdbf15cb89bf53">TriggerProcessor</a> (const std::string &amp;name, <a class="el" href="classldmx_1_1Process.html">Process</a> &amp;process)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1TriggerProcessor.html#a0cd922473ec3f3edcb4af55cc31efe69">~TriggerProcessor</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1TriggerProcessor.html#aa7485ff876b3cd8dac31654f60f1f242">configure</a> (const <a class="el" href="classldmx_1_1ParameterSet.html">ParameterSet</a> &amp;pSet)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1TriggerProcessor.html#a7434646cd3cafc083ffa1e481e8eeea5">produce</a> (<a class="el" href="classldmx_1_1Event.html">Event</a> &amp;event)</td></tr>
<tr><td colspan="2"><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">TString&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1TriggerProcessor.html#af6e2491cfcc9f6c7671e7f6567517e4b">algoName_</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classldmx_1_1TriggerResult.html">TriggerResult</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1TriggerProcessor.html#ac9e0a5057a2a1412b364e86c1bf3abe6">result_</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Provides a trigger decision for recon using a <a class="el" href="classldmx_1_1TriggerResult.html" title="Represents the trigger decision (pass/fail) for reconstruction.">TriggerResult</a> object. </p>
<dl class="note"><dt><b>Note:</b></dt><dd><a class="el" href="classldmx_1_1TriggerProcessor.html" title="Provides a trigger decision for recon using a TriggerResult object.">TriggerProcessor</a> takes in a set of parameters to be used in defining the trigger algorithm. An event is passed to the processor and the relevant algorithms are then run on the event (ECAL layer sum). A trigger decision is executed and the decision along with the algorithm name and relevant variables are stored in a <a class="el" href="classldmx_1_1TriggerResult.html" title="Represents the trigger decision (pass/fail) for reconstruction.">TriggerResult</a> object which is added to the collection. </dd></dl>

<p>Definition at line <a class="el" href="TriggerProcessor_8h_source.html#l00027">27</a> of file <a class="el" href="TriggerProcessor_8h_source.html">TriggerProcessor.h</a>.</p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="af939d94bda95b61752fdbf15cb89bf53"></a><!-- doxytag: member="ldmx::TriggerProcessor::TriggerProcessor" ref="af939d94bda95b61752fdbf15cb89bf53" args="(const std::string &amp;name, Process &amp;process)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ldmx::TriggerProcessor::TriggerProcessor </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classldmx_1_1Process.html">Process</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>process</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Class constructor. </p>

<p>Definition at line <a class="el" href="TriggerProcessor_8h_source.html#l00034">34</a> of file <a class="el" href="TriggerProcessor_8h_source.html">TriggerProcessor.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00034"></a>00034                                                                       :
<a name="l00035"></a>00035                 <a class="code" href="classldmx_1_1Producer.html#abd1f979d49afb16c520ca66840d174cc">Producer</a>(name, process) {
<a name="l00036"></a>00036             }

</pre></div></p>

</div>
</div>
<a class="anchor" id="a0cd922473ec3f3edcb4af55cc31efe69"></a><!-- doxytag: member="ldmx::TriggerProcessor::~TriggerProcessor" ref="a0cd922473ec3f3edcb4af55cc31efe69" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual ldmx::TriggerProcessor::~TriggerProcessor </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Class destructor. </p>

<p>Definition at line <a class="el" href="TriggerProcessor_8h_source.html#l00042">42</a> of file <a class="el" href="TriggerProcessor_8h_source.html">TriggerProcessor.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00042"></a>00042 {;}
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="aa7485ff876b3cd8dac31654f60f1f242"></a><!-- doxytag: member="ldmx::TriggerProcessor::configure" ref="aa7485ff876b3cd8dac31654f60f1f242" args="(const ParameterSet &amp;pSet)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ldmx::TriggerProcessor::configure </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classldmx_1_1ParameterSet.html">ParameterSet</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>pSet</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read in a set of user specified parameters to be used in defining aspects of the trigger. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pSet</em>&nbsp;</td><td>A set containing parameters to be used by the trigger algorithm. </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classldmx_1_1EventProcessor.html#a6a5ada71abe64354bfbbf5481843e955">ldmx::EventProcessor</a>.</p>

<p>Definition at line <a class="el" href="TriggerProcessor_8cxx_source.html#l00015">15</a> of file <a class="el" href="TriggerProcessor_8cxx_source.html">TriggerProcessor.cxx</a>.</p>

<p>References <a class="el" href="TriggerProcessor_8h_source.html#l00064">algoName_</a>, <a class="el" href="ParameterSet_8cxx_source.html#l00036">ldmx::ParameterSet::getDouble()</a>, and <a class="el" href="ParameterSet_8cxx_source.html#l00010">ldmx::ParameterSet::getInteger()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00015"></a>00015                                                              {
<a name="l00016"></a>00016 
<a name="l00017"></a>00017         layerESumCut_ = pSet.getDouble(<span class="stringliteral">&quot;threshold&quot;</span>);
<a name="l00018"></a>00018         mode_ = pSet.getInteger(<span class="stringliteral">&quot;mode&quot;</span>);
<a name="l00019"></a>00019         startLayer_ = pSet.getInteger(<span class="stringliteral">&quot;start_layer&quot;</span>);
<a name="l00020"></a>00020         endLayer_ = pSet.getInteger(<span class="stringliteral">&quot;end_layer&quot;</span>);
<a name="l00021"></a>00021 
<a name="l00022"></a>00022         <span class="keywordflow">if</span> (mode_ == 0) {
<a name="l00023"></a>00023             <a class="code" href="classldmx_1_1TriggerProcessor.html#af6e2491cfcc9f6c7671e7f6567517e4b">algoName_</a> = <span class="stringliteral">&quot;LayerSumTrig&quot;</span>;
<a name="l00024"></a>00024         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode_ == 1) {
<a name="l00025"></a>00025             <a class="code" href="classldmx_1_1TriggerProcessor.html#af6e2491cfcc9f6c7671e7f6567517e4b">algoName_</a> = <span class="stringliteral">&quot;CenterTower&quot;</span>;
<a name="l00026"></a>00026         }
<a name="l00027"></a>00027     }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7434646cd3cafc083ffa1e481e8eeea5"></a><!-- doxytag: member="ldmx::TriggerProcessor::produce" ref="a7434646cd3cafc083ffa1e481e8eeea5" args="(Event &amp;event)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ldmx::TriggerProcessor::produce </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classldmx_1_1Event.html">Event</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>event</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Run the trigger algorithm and create a <a class="el" href="classldmx_1_1TriggerResult.html" title="Represents the trigger decision (pass/fail) for reconstruction.">TriggerResult</a> object to contain info about the trigger decision such as pass/fail, number of saved variables, etc. param event The event to run trigger algorithm on. </p>

<p><p>Grab the Ecal hit collection for the given event</p>
<p>Loop over all ecal hits in the given event </p>
</p>

<p>Implements <a class="el" href="classldmx_1_1Producer.html#a7ac942786d11a4768ad430d52ba6a427">ldmx::Producer</a>.</p>

<p>Definition at line <a class="el" href="TriggerProcessor_8cxx_source.html#l00029">29</a> of file <a class="el" href="TriggerProcessor_8cxx_source.html">TriggerProcessor.cxx</a>.</p>

<p>References <a class="el" href="TriggerProcessor_8h_source.html#l00064">algoName_</a>, <a class="el" href="CalorimeterHit_8h_source.html#l00090">ldmx::CalorimeterHit::getEnergy()</a>, <a class="el" href="classldmx_1_1CalorimeterHit.html#ab3188ba562f0e71378b90aa48ee80c64">ldmx::CalorimeterHit::getLayer()</a>, <a class="el" href="TriggerProcessor_8h_source.html#l00082">result_</a>, <a class="el" href="classldmx_1_1TriggerResult.html#a66ad625eaa94cbf33251b7f7b139d5e0">ldmx::TriggerResult::set()</a>, and <a class="el" href="classldmx_1_1TriggerResult.html#af63404d01b3529ff5fb45d1587072b3a">ldmx::TriggerResult::setAlgoVar()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00029"></a>00029                                                {
<a name="l00030"></a>00030 
<a name="l00032"></a>00032         <span class="keyword">const</span> TClonesArray *ecalDigis = <span class="keyword">event</span>.getCollection(<span class="stringliteral">&quot;ecalDigis&quot;</span>);
<a name="l00033"></a>00033         <span class="keywordtype">int</span> numEcalHits = ecalDigis-&gt;GetEntriesFast();
<a name="l00034"></a>00034 
<a name="l00035"></a>00035         std::vector&lt;double&gt; layerDigiE(100, 0.0); <span class="comment">// big empty vector..</span>
<a name="l00036"></a>00036 
<a name="l00038"></a>00038         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iHit = 0; iHit &lt; numEcalHits; ++iHit) {
<a name="l00039"></a>00039             EcalHit *hit = (EcalHit*) ecalDigis-&gt;At(iHit);
<a name="l00040"></a>00040             <span class="keywordflow">if</span> (hit-&gt;getLayer() &lt; layerDigiE.size()) { <span class="comment">// just to be safe...</span>
<a name="l00041"></a>00041                 <span class="keywordflow">if</span> (mode_ == 0) { <span class="comment">// Sum over all cells in a given layer</span>
<a name="l00042"></a>00042                     layerDigiE[hit-&gt;getLayer()] += hit-&gt;getEnergy();
<a name="l00043"></a>00043                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode_ == 1) { <span class="comment">// Sum over cells in central tower only</span>
<a name="l00044"></a>00044                     <span class="comment">//std::pair&lt;float, float&gt; xyPos = hit-&gt;getCellCentroidXYPair(hit-&gt;getID());</span>
<a name="l00045"></a>00045                     <span class="comment">//float cellRadius = sqrt(pow(xyPos.first, 2) + pow(xyPos.second, 2));</span>
<a name="l00046"></a>00046                     <span class="comment">//if (cellRadius &lt; MAGICNUMBERHERE) {</span>
<a name="l00047"></a>00047                     <span class="comment">//    layerDigiE[hit-&gt;getLayer()] += hit-&gt;getEnergy();</span>
<a name="l00048"></a>00048                     <span class="comment">//}</span>
<a name="l00049"></a>00049                 }
<a name="l00050"></a>00050             }
<a name="l00051"></a>00051         }
<a name="l00052"></a>00052 
<a name="l00053"></a>00053         <span class="keywordtype">float</span> layerSum = 0;
<a name="l00054"></a>00054         <span class="keywordtype">bool</span> pass = <span class="keyword">false</span>;
<a name="l00055"></a>00055 
<a name="l00056"></a>00056         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iL = startLayer_; iL &lt; endLayer_; ++iL) {
<a name="l00057"></a>00057             layerSum += layerDigiE[iL];
<a name="l00058"></a>00058         }
<a name="l00059"></a>00059 
<a name="l00060"></a>00060         pass = (layerSum &lt;= layerESumCut_);
<a name="l00061"></a>00061 
<a name="l00062"></a>00062         <a class="code" href="classldmx_1_1TriggerProcessor.html#ac9e0a5057a2a1412b364e86c1bf3abe6">result_</a>.set(<a class="code" href="classldmx_1_1TriggerProcessor.html#af6e2491cfcc9f6c7671e7f6567517e4b">algoName_</a>, pass, 3);
<a name="l00063"></a>00063         <a class="code" href="classldmx_1_1TriggerProcessor.html#ac9e0a5057a2a1412b364e86c1bf3abe6">result_</a>.setAlgoVar(0, layerSum);
<a name="l00064"></a>00064         <a class="code" href="classldmx_1_1TriggerProcessor.html#ac9e0a5057a2a1412b364e86c1bf3abe6">result_</a>.setAlgoVar(1, layerESumCut_);
<a name="l00065"></a>00065         <a class="code" href="classldmx_1_1TriggerProcessor.html#ac9e0a5057a2a1412b364e86c1bf3abe6">result_</a>.setAlgoVar(2, endLayer_ - startLayer_);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067         <span class="keyword">event</span>.addToCollection(<span class="stringliteral">&quot;Trigger&quot;</span>, <a class="code" href="classldmx_1_1TriggerProcessor.html#ac9e0a5057a2a1412b364e86c1bf3abe6">result_</a>);
<a name="l00068"></a>00068     }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="af6e2491cfcc9f6c7671e7f6567517e4b"></a><!-- doxytag: member="ldmx::TriggerProcessor::algoName_" ref="af6e2491cfcc9f6c7671e7f6567517e4b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TString <a class="el" href="classldmx_1_1TriggerProcessor.html#af6e2491cfcc9f6c7671e7f6567517e4b">ldmx::TriggerProcessor::algoName_</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The energy sum to make cut on. The trigger mode to run in. Mode zero sums over all cells in layer, while in mode 1 only cells in center module are summed over. (TODO) The first layer of layer sum. The last layer of layer sum. The name of the trigger algorithm used. </p>

<p>Definition at line <a class="el" href="TriggerProcessor_8h_source.html#l00064">64</a> of file <a class="el" href="TriggerProcessor_8h_source.html">TriggerProcessor.h</a>.</p>

<p>Referenced by <a class="el" href="TriggerProcessor_8cxx_source.html#l00015">configure()</a>, and <a class="el" href="TriggerProcessor_8cxx_source.html#l00029">produce()</a>.</p>

</div>
</div>
<a class="anchor" id="ac9e0a5057a2a1412b364e86c1bf3abe6"></a><!-- doxytag: member="ldmx::TriggerProcessor::result_" ref="ac9e0a5057a2a1412b364e86c1bf3abe6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classldmx_1_1TriggerResult.html">TriggerResult</a> <a class="el" href="classldmx_1_1TriggerProcessor.html#ac9e0a5057a2a1412b364e86c1bf3abe6">ldmx::TriggerProcessor::result_</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Object to hold trigger results and variables </p>

<p>Definition at line <a class="el" href="TriggerProcessor_8h_source.html#l00082">82</a> of file <a class="el" href="TriggerProcessor_8h_source.html">TriggerProcessor.h</a>.</p>

<p>Referenced by <a class="el" href="TriggerProcessor_8cxx_source.html#l00029">produce()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>EventProc/include/EventProc/<a class="el" href="TriggerProcessor_8h_source.html">TriggerProcessor.h</a></li>
<li>EventProc/src/<a class="el" href="TriggerProcessor_8cxx_source.html">TriggerProcessor.cxx</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 7 Jul 2017 for LDMX Software by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
