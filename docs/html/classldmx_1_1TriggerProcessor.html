<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LDMX Software: ldmx::TriggerProcessor Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LDMX Software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><b>ldmx</b>      </li>
      <li class="navelem"><a class="el" href="classldmx_1_1TriggerProcessor.html">TriggerProcessor</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a>  </div>
  <div class="headertitle">
<div class="title">ldmx::TriggerProcessor Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="ldmx::TriggerProcessor" --><!-- doxytag: inherits="ldmx::Producer" -->
<p>Provides a trigger decision for recon using a <a class="el" href="classldmx_1_1TriggerResult.html" title="Represents the trigger decision (pass/fail) for reconstruction.">TriggerResult</a> object.  
 <a href="classldmx_1_1TriggerProcessor.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="TriggerProcessor_8h_source.html">TriggerProcessor.h</a>&gt;</code></p>

<p><a href="classldmx_1_1TriggerProcessor-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1TriggerProcessor.html#af939d94bda95b61752fdbf15cb89bf53">TriggerProcessor</a> (const std::string &amp;name, <a class="el" href="classldmx_1_1Process.html">Process</a> &amp;process)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1TriggerProcessor.html#a0cd922473ec3f3edcb4af55cc31efe69">~TriggerProcessor</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1TriggerProcessor.html#aa7485ff876b3cd8dac31654f60f1f242">configure</a> (const <a class="el" href="classldmx_1_1ParameterSet.html">ParameterSet</a> &amp;pSet)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1TriggerProcessor.html#a7434646cd3cafc083ffa1e481e8eeea5">produce</a> (<a class="el" href="classldmx_1_1Event.html">Event</a> &amp;event)</td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">TString&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1TriggerProcessor.html#af6e2491cfcc9f6c7671e7f6567517e4b">algoName_</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classldmx_1_1TriggerResult.html">TriggerResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1TriggerProcessor.html#ac9e0a5057a2a1412b364e86c1bf3abe6">result_</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Provides a trigger decision for recon using a <a class="el" href="classldmx_1_1TriggerResult.html" title="Represents the trigger decision (pass/fail) for reconstruction.">TriggerResult</a> object. </p>
<dl class="note"><dt><b>Note:</b></dt><dd><a class="el" href="classldmx_1_1TriggerProcessor.html" title="Provides a trigger decision for recon using a TriggerResult object.">TriggerProcessor</a> takes in a set of parameters to be used in defining the trigger algorithm. An event is passed to the processor and the relevant algorithms are then run on the event (ECAL layer sum). A trigger decision is executed and the decision along with the algorithm name and relevant variables are stored in a <a class="el" href="classldmx_1_1TriggerResult.html" title="Represents the trigger decision (pass/fail) for reconstruction.">TriggerResult</a> object which is added to the collection. </dd></dl>

<p>Definition at line <a class="el" href="TriggerProcessor_8h_source.html#l00027">27</a> of file <a class="el" href="TriggerProcessor_8h_source.html">TriggerProcessor.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="af939d94bda95b61752fdbf15cb89bf53"></a><!-- doxytag: member="ldmx::TriggerProcessor::TriggerProcessor" ref="af939d94bda95b61752fdbf15cb89bf53" args="(const std::string &amp;name, Process &amp;process)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ldmx::TriggerProcessor::TriggerProcessor </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classldmx_1_1Process.html">Process</a> &amp;&#160;</td>
          <td class="paramname"><em>process</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Class constructor. </p>

<p>Definition at line <a class="el" href="TriggerProcessor_8h_source.html#l00034">34</a> of file <a class="el" href="TriggerProcessor_8h_source.html">TriggerProcessor.h</a>.</p>
<div class="fragment"><pre class="fragment">                                                                      :
                <a class="code" href="classldmx_1_1Producer.html#abd1f979d49afb16c520ca66840d174cc">Producer</a>(name, process) {
            }
</pre></div>
</div>
</div>
<a class="anchor" id="a0cd922473ec3f3edcb4af55cc31efe69"></a><!-- doxytag: member="ldmx::TriggerProcessor::~TriggerProcessor" ref="a0cd922473ec3f3edcb4af55cc31efe69" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual ldmx::TriggerProcessor::~TriggerProcessor </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Class destructor. </p>

<p>Definition at line <a class="el" href="TriggerProcessor_8h_source.html#l00042">42</a> of file <a class="el" href="TriggerProcessor_8h_source.html">TriggerProcessor.h</a>.</p>
<div class="fragment"><pre class="fragment">{;}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="aa7485ff876b3cd8dac31654f60f1f242"></a><!-- doxytag: member="ldmx::TriggerProcessor::configure" ref="aa7485ff876b3cd8dac31654f60f1f242" args="(const ParameterSet &amp;pSet)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ldmx::TriggerProcessor::configure </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classldmx_1_1ParameterSet.html">ParameterSet</a> &amp;&#160;</td>
          <td class="paramname"><em>pSet</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read in a set of user specified parameters to be used in defining aspects of the trigger. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">pSet</td><td>A set containing parameters to be used by the trigger algorithm. </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classldmx_1_1EventProcessor.html#a6a5ada71abe64354bfbbf5481843e955">ldmx::EventProcessor</a>.</p>

<p>Definition at line <a class="el" href="TriggerProcessor_8cxx_source.html#l00015">15</a> of file <a class="el" href="TriggerProcessor_8cxx_source.html">TriggerProcessor.cxx</a>.</p>

<p>References <a class="el" href="TriggerProcessor_8h_source.html#l00064">algoName_</a>, <a class="el" href="ParameterSet_8cxx_source.html#l00036">ldmx::ParameterSet::getDouble()</a>, and <a class="el" href="ParameterSet_8cxx_source.html#l00010">ldmx::ParameterSet::getInteger()</a>.</p>
<div class="fragment"><pre class="fragment">                                                             {

        layerESumCut_ = pSet.getDouble(<span class="stringliteral">&quot;threshold&quot;</span>);
        mode_ = pSet.getInteger(<span class="stringliteral">&quot;mode&quot;</span>);
        startLayer_ = pSet.getInteger(<span class="stringliteral">&quot;start_layer&quot;</span>);
        endLayer_ = pSet.getInteger(<span class="stringliteral">&quot;end_layer&quot;</span>);

        <span class="keywordflow">if</span> (mode_ == 0) {
            <a class="code" href="classldmx_1_1TriggerProcessor.html#af6e2491cfcc9f6c7671e7f6567517e4b">algoName_</a> = <span class="stringliteral">&quot;LayerSumTrig&quot;</span>;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode_ == 1) {
            <a class="code" href="classldmx_1_1TriggerProcessor.html#af6e2491cfcc9f6c7671e7f6567517e4b">algoName_</a> = <span class="stringliteral">&quot;CenterTower&quot;</span>;
        }
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a7434646cd3cafc083ffa1e481e8eeea5"></a><!-- doxytag: member="ldmx::TriggerProcessor::produce" ref="a7434646cd3cafc083ffa1e481e8eeea5" args="(Event &amp;event)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ldmx::TriggerProcessor::produce </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classldmx_1_1Event.html">Event</a> &amp;&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Run the trigger algorithm and create a <a class="el" href="classldmx_1_1TriggerResult.html" title="Represents the trigger decision (pass/fail) for reconstruction.">TriggerResult</a> object to contain info about the trigger decision such as pass/fail, number of saved variables, etc. param event The event to run trigger algorithm on. </p>

<p><p>Grab the Ecal hit collection for the given event</p>
<p>Loop over all ecal hits in the given event </p>
</p>

<p>Implements <a class="el" href="classldmx_1_1Producer.html#a7ac942786d11a4768ad430d52ba6a427">ldmx::Producer</a>.</p>

<p>Definition at line <a class="el" href="TriggerProcessor_8cxx_source.html#l00029">29</a> of file <a class="el" href="TriggerProcessor_8cxx_source.html">TriggerProcessor.cxx</a>.</p>

<p>References <a class="el" href="TriggerProcessor_8h_source.html#l00064">algoName_</a>, <a class="el" href="CalorimeterHit_8h_source.html#l00090">ldmx::CalorimeterHit::getEnergy()</a>, <a class="el" href="classldmx_1_1CalorimeterHit.html#ab3188ba562f0e71378b90aa48ee80c64">ldmx::CalorimeterHit::getLayer()</a>, <a class="el" href="TriggerProcessor_8h_source.html#l00082">result_</a>, <a class="el" href="classldmx_1_1TriggerResult.html#a66ad625eaa94cbf33251b7f7b139d5e0">ldmx::TriggerResult::set()</a>, and <a class="el" href="classldmx_1_1TriggerResult.html#af63404d01b3529ff5fb45d1587072b3a">ldmx::TriggerResult::setAlgoVar()</a>.</p>
<div class="fragment"><pre class="fragment">                                               {

        <span class="keyword">const</span> TClonesArray *ecalDigis = <span class="keyword">event</span>.getCollection(<span class="stringliteral">&quot;ecalDigis&quot;</span>);
        <span class="keywordtype">int</span> numEcalHits = ecalDigis-&gt;GetEntriesFast();

        std::vector&lt;double&gt; layerDigiE(100, 0.0); <span class="comment">// big empty vector..</span>

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iHit = 0; iHit &lt; numEcalHits; ++iHit) {
            EcalHit *hit = (EcalHit*) ecalDigis-&gt;At(iHit);
            <span class="keywordflow">if</span> (hit-&gt;getLayer() &lt; layerDigiE.size()) { <span class="comment">// just to be safe...</span>
                <span class="keywordflow">if</span> (mode_ == 0) { <span class="comment">// Sum over all cells in a given layer</span>
                    layerDigiE[hit-&gt;getLayer()] += hit-&gt;getEnergy();
                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode_ == 1) { <span class="comment">// Sum over cells in central tower only</span>
                    <span class="comment">//std::pair&lt;float, float&gt; xyPos = hit-&gt;getCellCentroidXYPair(hit-&gt;getID());</span>
                    <span class="comment">//float cellRadius = sqrt(pow(xyPos.first, 2) + pow(xyPos.second, 2));</span>
                    <span class="comment">//if (cellRadius &lt; MAGICNUMBERHERE) {</span>
                    <span class="comment">//    layerDigiE[hit-&gt;getLayer()] += hit-&gt;getEnergy();</span>
                    <span class="comment">//}</span>
                }
            }
        }

        <span class="keywordtype">float</span> layerSum = 0;
        <span class="keywordtype">bool</span> pass = <span class="keyword">false</span>;

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iL = startLayer_; iL &lt; endLayer_; ++iL) {
            layerSum += layerDigiE[iL];
        }

        pass = (layerSum &lt;= layerESumCut_);

        <a class="code" href="classldmx_1_1TriggerProcessor.html#ac9e0a5057a2a1412b364e86c1bf3abe6">result_</a>.set(<a class="code" href="classldmx_1_1TriggerProcessor.html#af6e2491cfcc9f6c7671e7f6567517e4b">algoName_</a>, pass, 3);
        <a class="code" href="classldmx_1_1TriggerProcessor.html#ac9e0a5057a2a1412b364e86c1bf3abe6">result_</a>.setAlgoVar(0, layerSum);
        <a class="code" href="classldmx_1_1TriggerProcessor.html#ac9e0a5057a2a1412b364e86c1bf3abe6">result_</a>.setAlgoVar(1, layerESumCut_);
        <a class="code" href="classldmx_1_1TriggerProcessor.html#ac9e0a5057a2a1412b364e86c1bf3abe6">result_</a>.setAlgoVar(2, endLayer_ - startLayer_);

        <span class="keyword">event</span>.addToCollection(<span class="stringliteral">&quot;Trigger&quot;</span>, <a class="code" href="classldmx_1_1TriggerProcessor.html#ac9e0a5057a2a1412b364e86c1bf3abe6">result_</a>);
    }
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="af6e2491cfcc9f6c7671e7f6567517e4b"></a><!-- doxytag: member="ldmx::TriggerProcessor::algoName_" ref="af6e2491cfcc9f6c7671e7f6567517e4b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TString <a class="el" href="classldmx_1_1TriggerProcessor.html#af6e2491cfcc9f6c7671e7f6567517e4b">ldmx::TriggerProcessor::algoName_</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The energy sum to make cut on. The trigger mode to run in. Mode zero sums over all cells in layer, while in mode 1 only cells in center module are summed over. (TODO) The first layer of layer sum. The last layer of layer sum. The name of the trigger algorithm used. </p>

<p>Definition at line <a class="el" href="TriggerProcessor_8h_source.html#l00064">64</a> of file <a class="el" href="TriggerProcessor_8h_source.html">TriggerProcessor.h</a>.</p>

<p>Referenced by <a class="el" href="TriggerProcessor_8cxx_source.html#l00015">configure()</a>, and <a class="el" href="TriggerProcessor_8cxx_source.html#l00029">produce()</a>.</p>

</div>
</div>
<a class="anchor" id="ac9e0a5057a2a1412b364e86c1bf3abe6"></a><!-- doxytag: member="ldmx::TriggerProcessor::result_" ref="ac9e0a5057a2a1412b364e86c1bf3abe6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classldmx_1_1TriggerResult.html">TriggerResult</a> <a class="el" href="classldmx_1_1TriggerProcessor.html#ac9e0a5057a2a1412b364e86c1bf3abe6">ldmx::TriggerProcessor::result_</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Object to hold trigger results and variables </p>

<p>Definition at line <a class="el" href="TriggerProcessor_8h_source.html#l00082">82</a> of file <a class="el" href="TriggerProcessor_8h_source.html">TriggerProcessor.h</a>.</p>

<p>Referenced by <a class="el" href="TriggerProcessor_8cxx_source.html#l00029">produce()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>EventProc/include/EventProc/<a class="el" href="TriggerProcessor_8h_source.html">TriggerProcessor.h</a></li>
<li>EventProc/src/<a class="el" href="TriggerProcessor_8cxx_source.html">TriggerProcessor.cxx</a></li>
</ul>
</div>
<hr class="footer"/><address class="footer"><small>Generated by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
