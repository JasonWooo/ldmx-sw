<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LDMX Software: ldmx::ConfigurePython Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><b>ldmx</b>::<a class="el" href="classldmx_1_1ConfigurePython.html">ConfigurePython</a>
  </div>
</div>
<div class="contents">
<h1>ldmx::ConfigurePython Class Reference</h1><!-- doxytag: class="ldmx::ConfigurePython" -->
<p>Utility class which reads/executes a python script and creates a <a class="el" href="classldmx_1_1Process.html" title="Class which represents the process under execution.">Process</a> object based on the input.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="ConfigurePython_8h_source.html">ConfigurePython.h</a>&gt;</code></p>

<p><a href="classldmx_1_1ConfigurePython-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structldmx_1_1ConfigurePython_1_1ProcessorInfo.html">ProcessorInfo</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Represents the configuration of an <a class="el" href="classldmx_1_1EventProcessor.html" title="Base class for all event processing components.">EventProcessor</a> in the job.  <a href="structldmx_1_1ConfigurePython_1_1ProcessorInfo.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1ConfigurePython.html#a4f9e289005ebe9a4e366efe2e227c390">ConfigurePython</a> (const std::string &amp;pythonScript, char *args[], int nargs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1ConfigurePython.html#a8faf714491e50cdaac51adfea5991ccd">~ConfigurePython</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classldmx_1_1Process.html">Process</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1ConfigurePython.html#a16c95925a35f1621496d84f2b9ff271f">makeProcess</a> ()</td></tr>
<tr><td colspan="2"><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::string&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1ConfigurePython.html#acc7e183a3417d290890d47476ab50aa8">passname_</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::string &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1ConfigurePython.html#a03862dd75f2260a683cd8cb754c0ce1e">inputFiles_</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::string &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1ConfigurePython.html#a638ec8a4db7ace29c62e773395b63d36">keepRules_</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::string &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1ConfigurePython.html#ac92502918c7289b51e9189f2077ca7c5">libraries_</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::string &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1ConfigurePython.html#a9ec35dcf8f1908874a1b784697b250c6">outputFiles_</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::string&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1ConfigurePython.html#ab733492c9ebe4dfbe7d57f9b3366156a">histoOutFile_</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structldmx_1_1ConfigurePython_1_1ProcessorInfo.html">ProcessorInfo</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classldmx_1_1ConfigurePython.html#a448506b08fdb4551c0051250d28f6127">sequence_</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Utility class which reads/executes a python script and creates a <a class="el" href="classldmx_1_1Process.html" title="Class which represents the process under execution.">Process</a> object based on the input. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>The configuration language is documented in the overall Framework package documentation. </dd></dl>

<p>Definition at line <a class="el" href="ConfigurePython_8h_source.html#l00026">26</a> of file <a class="el" href="ConfigurePython_8h_source.html">ConfigurePython.h</a>.</p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a4f9e289005ebe9a4e366efe2e227c390"></a><!-- doxytag: member="ldmx::ConfigurePython::ConfigurePython" ref="a4f9e289005ebe9a4e366efe2e227c390" args="(const std::string &amp;pythonScript, char *args[], int nargs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ldmx::ConfigurePython::ConfigurePython </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>pythonScript</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>args</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nargs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Class constructor.</p>
<p>This method contains all the parsing and execution of the python script.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pythonScript</em>&nbsp;</td><td>Filename location of the python script. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>args</em>&nbsp;</td><td>Commandline arguments to be passed to the python script. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nargs</em>&nbsp;</td><td>Number of commandline arguments. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ConfigurePython_8cxx_source.html#l00034">34</a> of file <a class="el" href="ConfigurePython_8cxx_source.html">ConfigurePython.cxx</a>.</p>

<p>References <a class="el" href="Exception_8h_source.html#l00127">EXCEPTION_RAISE</a>, <a class="el" href="ConfigurePython_8h_source.html#l00072">histoOutFile_</a>, <a class="el" href="ConfigurePython_8h_source.html#l00057">inputFiles_</a>, <a class="el" href="ParameterSet_8cxx_source.html#l00006">ldmx::ParameterSet::insert()</a>, <a class="el" href="ConfigurePython_8h_source.html#l00066">keepRules_</a>, <a class="el" href="ConfigurePython_8h_source.html#l00068">libraries_</a>, <a class="el" href="ConfigurePython_8h_source.html#l00070">outputFiles_</a>, <a class="el" href="ConfigurePython_8h_source.html#l00054">passname_</a>, and <a class="el" href="ConfigurePython_8h_source.html#l00085">sequence_</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00034"></a>00034                                                                                            {
<a name="l00035"></a>00035         std::string path(<span class="stringliteral">&quot;.&quot;</span>);
<a name="l00036"></a>00036         std::string cmd = pythonScript;
<a name="l00037"></a>00037 
<a name="l00038"></a>00038         <span class="comment">// if a path was specified, get that out</span>
<a name="l00039"></a>00039         <span class="keywordflow">if</span> (pythonScript.rfind(<span class="stringliteral">&quot;/&quot;</span>) != std::string::npos) {
<a name="l00040"></a>00040             path = pythonScript.substr(0, pythonScript.rfind(<span class="stringliteral">&quot;/&quot;</span>));
<a name="l00041"></a>00041             cmd = pythonScript.substr(pythonScript.rfind(<span class="stringliteral">&quot;/&quot;</span>) + 1);
<a name="l00042"></a>00042         }
<a name="l00043"></a>00043         cmd = cmd.substr(0, cmd.find(<span class="stringliteral">&quot;.py&quot;</span>));
<a name="l00044"></a>00044 
<a name="l00045"></a>00045         Py_Initialize();
<a name="l00046"></a>00046         <span class="keywordflow">if</span> (nargs &gt; 0) {
<a name="l00047"></a>00047             <span class="keywordtype">char</span>** targs = <span class="keyword">new</span> <span class="keywordtype">char</span>*[nargs + 1];
<a name="l00048"></a>00048             targs[0] = (<span class="keywordtype">char</span>*) pythonScript.c_str();
<a name="l00049"></a>00049             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nargs; i++)
<a name="l00050"></a>00050                 targs[i + 1] = args[i];
<a name="l00051"></a>00051             PySys_SetArgvEx(nargs, targs, 1);
<a name="l00052"></a>00052             <span class="keyword">delete</span>[] targs;
<a name="l00053"></a>00053         }
<a name="l00054"></a>00054 
<a name="l00055"></a>00055         PyObject* script, *temp, *process, *pMain, *pylist;
<a name="l00056"></a>00056         temp = PyString_FromString(cmd.c_str());
<a name="l00057"></a>00057         script = PyImport_ImportModule(cmd.c_str());
<a name="l00058"></a>00058         Py_DECREF(temp);
<a name="l00059"></a>00059 
<a name="l00060"></a>00060         <span class="keywordflow">if</span> (script == 0) {
<a name="l00061"></a>00061             PyErr_Print();
<a name="l00062"></a>00062             <a class="code" href="Exception_8h.html#a6d45ac49a0cb250fe3cabf8cf3fae7e8" title="Utility macro for throwing exceptions, automatically including the necessary file...">EXCEPTION_RAISE</a>(<span class="stringliteral">&quot;ConfigureError&quot;</span>, <span class="stringliteral">&quot;Problem loading python script&quot;</span>);
<a name="l00063"></a>00063         }
<a name="l00064"></a>00064 
<a name="l00065"></a>00065         PyObject* pCMod = PyObject_GetAttrString(script, <span class="stringliteral">&quot;ldmxcfg&quot;</span>);
<a name="l00066"></a>00066         <span class="keywordflow">if</span> (pCMod == 0) {
<a name="l00067"></a>00067             PyErr_Print();
<a name="l00068"></a>00068             <a class="code" href="Exception_8h.html#a6d45ac49a0cb250fe3cabf8cf3fae7e8" title="Utility macro for throwing exceptions, automatically including the necessary file...">EXCEPTION_RAISE</a>(<span class="stringliteral">&quot;ConfigureError&quot;</span>, <span class="stringliteral">&quot;Problem loading python script&quot;</span>);
<a name="l00069"></a>00069         }
<a name="l00070"></a>00070         PyObject* pProcessClass = PyObject_GetAttrString(pCMod, <span class="stringliteral">&quot;Process&quot;</span>);
<a name="l00071"></a>00071         Py_DECREF(pCMod);
<a name="l00072"></a>00072         <span class="keywordflow">if</span> (pProcessClass == 0) {
<a name="l00073"></a>00073             PyErr_Print();
<a name="l00074"></a>00074             <a class="code" href="Exception_8h.html#a6d45ac49a0cb250fe3cabf8cf3fae7e8" title="Utility macro for throwing exceptions, automatically including the necessary file...">EXCEPTION_RAISE</a>(<span class="stringliteral">&quot;ConfigureError&quot;</span>, <span class="stringliteral">&quot;Problem loading python script&quot;</span>);
<a name="l00075"></a>00075         }
<a name="l00076"></a>00076 
<a name="l00077"></a>00077         PyObject* pProcess = PyObject_GetAttrString(pProcessClass, <span class="stringliteral">&quot;lastProcess&quot;</span>);
<a name="l00078"></a>00078         Py_DECREF(pProcessClass);
<a name="l00079"></a>00079         <span class="keywordflow">if</span> (pProcess == 0) {
<a name="l00080"></a>00080             PyErr_Print();
<a name="l00081"></a>00081             <a class="code" href="Exception_8h.html#a6d45ac49a0cb250fe3cabf8cf3fae7e8" title="Utility macro for throwing exceptions, automatically including the necessary file...">EXCEPTION_RAISE</a>(<span class="stringliteral">&quot;ConfigureError&quot;</span>, <span class="stringliteral">&quot;Problem loading python script&quot;</span>);
<a name="l00082"></a>00082         }
<a name="l00083"></a>00083 
<a name="l00084"></a>00084         <a class="code" href="classldmx_1_1ConfigurePython.html#acc7e183a3417d290890d47476ab50aa8">passname_</a> = stringMember(pProcess, <span class="stringliteral">&quot;passName&quot;</span>);
<a name="l00085"></a>00085         eventLimit_ = intMember(pProcess, <span class="stringliteral">&quot;maxEvents&quot;</span>);
<a name="l00086"></a>00086         run_ = intMember(pProcess, <span class="stringliteral">&quot;run&quot;</span>);
<a name="l00087"></a>00087         <a class="code" href="classldmx_1_1ConfigurePython.html#ab733492c9ebe4dfbe7d57f9b3366156a">histoOutFile_</a> = stringMember(pProcess, <span class="stringliteral">&quot;histogramFile&quot;</span>);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         PyObject* pysequence = PyObject_GetAttrString(pProcess, <span class="stringliteral">&quot;sequence&quot;</span>);
<a name="l00090"></a>00090         <span class="keywordflow">if</span> (!PyList_Check(pysequence)) {
<a name="l00091"></a>00091             <a class="code" href="Exception_8h.html#a6d45ac49a0cb250fe3cabf8cf3fae7e8" title="Utility macro for throwing exceptions, automatically including the necessary file...">EXCEPTION_RAISE</a>(<span class="stringliteral">&quot;ConfigureError&quot;</span>, <span class="stringliteral">&quot;sequence is not a python list as expected.&quot;</span>);
<a name="l00092"></a>00092         }
<a name="l00093"></a>00093         <span class="keywordflow">for</span> (Py_ssize_t i = 0; i &lt; PyList_Size(pysequence); i++) {
<a name="l00094"></a>00094             PyObject* processor = PyList_GetItem(pysequence, i);
<a name="l00095"></a>00095             ProcessorInfo pi;
<a name="l00096"></a>00096             pi.classname_ = stringMember(processor, <span class="stringliteral">&quot;className&quot;</span>);
<a name="l00097"></a>00097             pi.instancename_ = stringMember(processor, <span class="stringliteral">&quot;instanceName&quot;</span>);
<a name="l00098"></a>00098 
<a name="l00099"></a>00099             PyObject* params = PyObject_GetAttrString(processor, <span class="stringliteral">&quot;parameters&quot;</span>);
<a name="l00100"></a>00100             <span class="keywordflow">if</span> (params != 0 &amp;&amp; PyDict_Check(params)) {
<a name="l00101"></a>00101                 PyObject *key(0), *value(0);
<a name="l00102"></a>00102                 Py_ssize_t pos = 0;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104                 <span class="keywordflow">while</span> (PyDict_Next(params, &amp;pos, &amp;key, &amp;value)) {
<a name="l00105"></a>00105                     std::string skey = PyString_AsString(key);
<a name="l00106"></a>00106                     <span class="keywordflow">if</span> (PyInt_Check(value)) {
<a name="l00107"></a>00107                         pi.params_.insert(skey, <span class="keywordtype">int</span>(PyInt_AsLong(value)));
<a name="l00108"></a>00108                         <span class="comment">//printf(&quot;Int Key: %s\n&quot;,skey.c_str());</span>
<a name="l00109"></a>00109                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PyFloat_Check(value)) {
<a name="l00110"></a>00110                         pi.params_.insert(skey, PyFloat_AsDouble(value));
<a name="l00111"></a>00111                         <span class="comment">//printf(&quot;Double Key: %s\n&quot;,skey.c_str());</span>
<a name="l00112"></a>00112                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PyString_Check(value)) {
<a name="l00113"></a>00113                         pi.params_.insert(skey, PyString_AsString(value));
<a name="l00114"></a>00114                         <span class="comment">//printf(&quot;String Key: %s\n&quot;,skey.c_str());</span>
<a name="l00115"></a>00115                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PyList_Check(value)) { <span class="comment">// assume everything is same value as first value</span>
<a name="l00116"></a>00116                         <span class="keywordflow">if</span> (PyList_Size(value) &gt; 0) {
<a name="l00117"></a>00117                             PyObject* vec0 = PyList_GetItem(value, 0);
<a name="l00118"></a>00118                             <span class="keywordflow">if</span> (PyInt_Check(vec0)) {
<a name="l00119"></a>00119                                 std::vector&lt;int&gt; vals;
<a name="l00120"></a>00120                                 <span class="keywordflow">for</span> (Py_ssize_t j = 0; j &lt; PyList_Size(value); j++)
<a name="l00121"></a>00121                                     vals.push_back(PyInt_AsLong(PyList_GetItem(value, j)));
<a name="l00122"></a>00122                                 pi.params_.insert(skey, vals);
<a name="l00123"></a>00123                                 <span class="comment">//printf(&quot;VInt Key: %s\n&quot;,skey.c_str());</span>
<a name="l00124"></a>00124                             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PyFloat_Check(vec0)) {
<a name="l00125"></a>00125                                 std::vector&lt;double&gt; vals;
<a name="l00126"></a>00126                                 <span class="keywordflow">for</span> (Py_ssize_t j = 0; j &lt; PyList_Size(value); j++)
<a name="l00127"></a>00127                                     vals.push_back(PyFloat_AsDouble(PyList_GetItem(value, j)));
<a name="l00128"></a>00128                                 pi.params_.insert(skey, vals);
<a name="l00129"></a>00129                                 <span class="comment">//printf(&quot;VDouble Key: %s\n&quot;,skey.c_str());</span>
<a name="l00130"></a>00130                             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PyString_Check(vec0)) {
<a name="l00131"></a>00131                                 std::vector&lt;std::string&gt; vals;
<a name="l00132"></a>00132                                 <span class="keywordflow">for</span> (Py_ssize_t j = 0; j &lt; PyList_Size(value); j++)
<a name="l00133"></a>00133                                     vals.push_back(PyString_AsString(PyList_GetItem(value, j)));
<a name="l00134"></a>00134                                 pi.params_.insert(skey, vals);
<a name="l00135"></a>00135                                 <span class="comment">//printf(&quot;VString Key: %s\n&quot;,skey.c_str());</span>
<a name="l00136"></a>00136                             }
<a name="l00137"></a>00137                         }
<a name="l00138"></a>00138                     }
<a name="l00139"></a>00139                 }
<a name="l00140"></a>00140             }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142             <a class="code" href="classldmx_1_1ConfigurePython.html#a448506b08fdb4551c0051250d28f6127">sequence_</a>.push_back(pi);
<a name="l00143"></a>00143         }
<a name="l00144"></a>00144         Py_DECREF(pysequence);
<a name="l00145"></a>00145 
<a name="l00146"></a>00146         pylist = PyObject_GetAttrString(pProcess, <span class="stringliteral">&quot;keep&quot;</span>);
<a name="l00147"></a>00147         <span class="keywordflow">if</span> (!PyList_Check(pylist)) {
<a name="l00148"></a>00148             std::cerr &lt;&lt; <span class="stringliteral">&quot;keep is not a python list as expected.\n&quot;</span>;
<a name="l00149"></a>00149             <span class="keywordflow">return</span>;
<a name="l00150"></a>00150         }
<a name="l00151"></a>00151         <span class="keywordflow">for</span> (Py_ssize_t i = 0; i &lt; PyList_Size(pylist); i++) {
<a name="l00152"></a>00152             PyObject* elem = PyList_GetItem(pylist, i);
<a name="l00153"></a>00153             <a class="code" href="classldmx_1_1ConfigurePython.html#a638ec8a4db7ace29c62e773395b63d36">keepRules_</a>.push_back(PyString_AsString(elem));
<a name="l00154"></a>00154         }
<a name="l00155"></a>00155         Py_DECREF(pylist);
<a name="l00156"></a>00156 
<a name="l00157"></a>00157         pylist = PyObject_GetAttrString(pProcess, <span class="stringliteral">&quot;inputFiles&quot;</span>);
<a name="l00158"></a>00158         <span class="keywordflow">if</span> (!PyList_Check(pylist)) {
<a name="l00159"></a>00159             std::cerr &lt;&lt; <span class="stringliteral">&quot;inputFiles is not a python list as expected.\n&quot;</span>;
<a name="l00160"></a>00160             <span class="keywordflow">return</span>;
<a name="l00161"></a>00161         }
<a name="l00162"></a>00162         <span class="keywordflow">for</span> (Py_ssize_t i = 0; i &lt; PyList_Size(pylist); i++) {
<a name="l00163"></a>00163             PyObject* elem = PyList_GetItem(pylist, i);
<a name="l00164"></a>00164             <a class="code" href="classldmx_1_1ConfigurePython.html#a03862dd75f2260a683cd8cb754c0ce1e">inputFiles_</a>.push_back(PyString_AsString(elem));
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166         Py_DECREF(pylist);
<a name="l00167"></a>00167 
<a name="l00168"></a>00168         pylist = PyObject_GetAttrString(pProcess, <span class="stringliteral">&quot;outputFiles&quot;</span>);
<a name="l00169"></a>00169         <span class="keywordflow">if</span> (!PyList_Check(pylist)) {
<a name="l00170"></a>00170             std::cerr &lt;&lt; <span class="stringliteral">&quot;outputFiles is not a python list as expected.\n&quot;</span>;
<a name="l00171"></a>00171             <span class="keywordflow">return</span>;
<a name="l00172"></a>00172         }
<a name="l00173"></a>00173         <span class="keywordflow">for</span> (Py_ssize_t i = 0; i &lt; PyList_Size(pylist); i++) {
<a name="l00174"></a>00174             PyObject* elem = PyList_GetItem(pylist, i);
<a name="l00175"></a>00175             <a class="code" href="classldmx_1_1ConfigurePython.html#a9ec35dcf8f1908874a1b784697b250c6">outputFiles_</a>.push_back(PyString_AsString(elem));
<a name="l00176"></a>00176         }
<a name="l00177"></a>00177         Py_DECREF(pylist);
<a name="l00178"></a>00178 
<a name="l00179"></a>00179         pylist = PyObject_GetAttrString(pProcess, <span class="stringliteral">&quot;libraries&quot;</span>);
<a name="l00180"></a>00180         <span class="keywordflow">if</span> (!PyList_Check(pylist)) {
<a name="l00181"></a>00181             std::cerr &lt;&lt; <span class="stringliteral">&quot;libraries is not a python list as expected.\n&quot;</span>;
<a name="l00182"></a>00182             <span class="keywordflow">return</span>;
<a name="l00183"></a>00183         }
<a name="l00184"></a>00184         <span class="keywordflow">for</span> (Py_ssize_t i = 0; i &lt; PyList_Size(pylist); i++) {
<a name="l00185"></a>00185             PyObject* elem = PyList_GetItem(pylist, i);
<a name="l00186"></a>00186             <a class="code" href="classldmx_1_1ConfigurePython.html#ac92502918c7289b51e9189f2077ca7c5">libraries_</a>.push_back(PyString_AsString(elem));
<a name="l00187"></a>00187         }
<a name="l00188"></a>00188         Py_DECREF(pylist);
<a name="l00189"></a>00189     }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8faf714491e50cdaac51adfea5991ccd"></a><!-- doxytag: member="ldmx::ConfigurePython::~ConfigurePython" ref="a8faf714491e50cdaac51adfea5991ccd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ldmx::ConfigurePython::~ConfigurePython </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Class destructor. </p>

<p>Definition at line <a class="el" href="ConfigurePython_8cxx_source.html#l00191">191</a> of file <a class="el" href="ConfigurePython_8cxx_source.html">ConfigurePython.cxx</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00191"></a>00191                                       {
<a name="l00192"></a>00192         Py_Finalize();
<a name="l00193"></a>00193     }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a16c95925a35f1621496d84f2b9ff271f"></a><!-- doxytag: member="ldmx::ConfigurePython::makeProcess" ref="a16c95925a35f1621496d84f2b9ff271f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classldmx_1_1Process.html">Process</a> * ldmx::ConfigurePython::makeProcess </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Create a process object based on the python file information </p>

<p>Definition at line <a class="el" href="ConfigurePython_8cxx_source.html#l00195">195</a> of file <a class="el" href="ConfigurePython_8cxx_source.html">ConfigurePython.cxx</a>.</p>

<p>References <a class="el" href="classldmx_1_1Process.html#a0ccf966625e23c3a630c34e86bcd674d">ldmx::Process::addDropKeepRule()</a>, <a class="el" href="classldmx_1_1Process.html#acad5781b242d2eabf3b6af1ae3107d21">ldmx::Process::addFileToProcess()</a>, <a class="el" href="classldmx_1_1Process.html#a5b1d6cba024c0ff342857ba3cc250e9c">ldmx::Process::addOutputFileName()</a>, <a class="el" href="classldmx_1_1Process.html#a9e4a3a7bcff60999ba666b23fb53d38e">ldmx::Process::addToSequence()</a>, <a class="el" href="EventProcessor_8h_source.html#l00059">ldmx::EventProcessor::configure()</a>, <a class="el" href="EventProcessorFactory_8cxx_source.html#l00042">ldmx::EventProcessorFactory::createEventProcessor()</a>, <a class="el" href="Exception_8h_source.html#l00127">EXCEPTION_RAISE</a>, <a class="el" href="EventProcessorFactory_8h_source.html#l00032">ldmx::EventProcessorFactory::getInstance()</a>, <a class="el" href="ConfigurePython_8h_source.html#l00072">histoOutFile_</a>, <a class="el" href="ConfigurePython_8h_source.html#l00057">inputFiles_</a>, <a class="el" href="ConfigurePython_8h_source.html#l00066">keepRules_</a>, <a class="el" href="ConfigurePython_8h_source.html#l00068">libraries_</a>, <a class="el" href="EventProcessorFactory_8cxx_source.html#l00050">ldmx::EventProcessorFactory::loadLibrary()</a>, <a class="el" href="ConfigurePython_8h_source.html#l00070">outputFiles_</a>, <a class="el" href="ConfigurePython_8h_source.html#l00054">passname_</a>, <a class="el" href="ConfigurePython_8h_source.html#l00085">sequence_</a>, <a class="el" href="Process_8h_source.html#l00105">ldmx::Process::setEventLimit()</a>, <a class="el" href="classldmx_1_1Process.html#a9469359cefcd738a9d14c0791a20fbb2">ldmx::Process::setHistogramFileName()</a>, and <a class="el" href="Process_8h_source.html#l00097">ldmx::Process::setRunNumber()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00195"></a>00195                                           {
<a name="l00196"></a>00196         Process* p = <span class="keyword">new</span> Process(<a class="code" href="classldmx_1_1ConfigurePython.html#acc7e183a3417d290890d47476ab50aa8">passname_</a>);
<a name="l00197"></a>00197 
<a name="l00198"></a>00198         <span class="keywordflow">for</span> (<span class="keyword">auto</span> lib : <a class="code" href="classldmx_1_1ConfigurePython.html#ac92502918c7289b51e9189f2077ca7c5">libraries_</a>) {
<a name="l00199"></a>00199             <a class="code" href="classldmx_1_1EventProcessorFactory.html#a288aa4dd9ba6fb37f13ee78e9054ac83">EventProcessorFactory::getInstance</a>().loadLibrary(lib);
<a name="l00200"></a>00200         }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202         <span class="keywordflow">for</span> (<span class="keyword">auto</span> proc : <a class="code" href="classldmx_1_1ConfigurePython.html#a448506b08fdb4551c0051250d28f6127">sequence_</a>) {
<a name="l00203"></a>00203             EventProcessor* ep = <a class="code" href="classldmx_1_1EventProcessorFactory.html#a288aa4dd9ba6fb37f13ee78e9054ac83">EventProcessorFactory::getInstance</a>().createEventProcessor(proc.classname_, proc.instancename_, *p);
<a name="l00204"></a>00204             <span class="keywordflow">if</span> (ep == 0) {
<a name="l00205"></a>00205                 <a class="code" href="Exception_8h.html#a6d45ac49a0cb250fe3cabf8cf3fae7e8" title="Utility macro for throwing exceptions, automatically including the necessary file...">EXCEPTION_RAISE</a>(<span class="stringliteral">&quot;UnableToCreate&quot;</span>, <span class="stringliteral">&quot;Unable to create instance &apos;&quot;</span> + proc.instancename_ + <span class="stringliteral">&quot;&apos; of class &apos;&quot;</span> + proc.classname_ + <span class="stringliteral">&quot;&apos;&quot;</span>);
<a name="l00206"></a>00206             }
<a name="l00207"></a>00207             ep-&gt;configure(proc.params_);
<a name="l00208"></a>00208             p-&gt;addToSequence(ep);
<a name="l00209"></a>00209         }
<a name="l00210"></a>00210         <span class="keywordflow">for</span> (<span class="keyword">auto</span> file : <a class="code" href="classldmx_1_1ConfigurePython.html#a03862dd75f2260a683cd8cb754c0ce1e">inputFiles_</a>) {
<a name="l00211"></a>00211             p-&gt;addFileToProcess(file);
<a name="l00212"></a>00212         }
<a name="l00213"></a>00213         <span class="keywordflow">for</span> (<span class="keyword">auto</span> file : <a class="code" href="classldmx_1_1ConfigurePython.html#a9ec35dcf8f1908874a1b784697b250c6">outputFiles_</a>) {
<a name="l00214"></a>00214             p-&gt;addOutputFileName(file);
<a name="l00215"></a>00215         }
<a name="l00216"></a>00216         <span class="keywordflow">for</span> (<span class="keyword">auto</span> rule : <a class="code" href="classldmx_1_1ConfigurePython.html#a638ec8a4db7ace29c62e773395b63d36">keepRules_</a>) {
<a name="l00217"></a>00217             p-&gt;addDropKeepRule(rule);
<a name="l00218"></a>00218         }
<a name="l00219"></a>00219         <span class="keywordflow">if</span> (run_ &gt; 0)
<a name="l00220"></a>00220             p-&gt;setRunNumber(run_);
<a name="l00221"></a>00221         p-&gt;setEventLimit(eventLimit_);
<a name="l00222"></a>00222         p-&gt;setHistogramFileName(<a class="code" href="classldmx_1_1ConfigurePython.html#ab733492c9ebe4dfbe7d57f9b3366156a">histoOutFile_</a>);
<a name="l00223"></a>00223 
<a name="l00224"></a>00224         <span class="keywordflow">return</span> p;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226     }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="ab733492c9ebe4dfbe7d57f9b3366156a"></a><!-- doxytag: member="ldmx::ConfigurePython::histoOutFile_" ref="ab733492c9ebe4dfbe7d57f9b3366156a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string <a class="el" href="classldmx_1_1ConfigurePython.html#ab733492c9ebe4dfbe7d57f9b3366156a">ldmx::ConfigurePython::histoOutFile_</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Histogram output file name </p>

<p>Definition at line <a class="el" href="ConfigurePython_8h_source.html#l00072">72</a> of file <a class="el" href="ConfigurePython_8h_source.html">ConfigurePython.h</a>.</p>

<p>Referenced by <a class="el" href="ConfigurePython_8cxx_source.html#l00034">ConfigurePython()</a>, and <a class="el" href="ConfigurePython_8cxx_source.html#l00195">makeProcess()</a>.</p>

</div>
</div>
<a class="anchor" id="a03862dd75f2260a683cd8cb754c0ce1e"></a><!-- doxytag: member="ldmx::ConfigurePython::inputFiles_" ref="a03862dd75f2260a683cd8cb754c0ce1e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::string&gt; <a class="el" href="classldmx_1_1ConfigurePython.html#a03862dd75f2260a683cd8cb754c0ce1e">ldmx::ConfigurePython::inputFiles_</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The maximum number of events to process, if provided in python file. The run number to use when generating events (no input file), if provided in python file. List of input ROOT files to process in the job, if provided in python file. </p>

<p>Definition at line <a class="el" href="ConfigurePython_8h_source.html#l00057">57</a> of file <a class="el" href="ConfigurePython_8h_source.html">ConfigurePython.h</a>.</p>

<p>Referenced by <a class="el" href="ConfigurePython_8cxx_source.html#l00034">ConfigurePython()</a>, and <a class="el" href="ConfigurePython_8cxx_source.html#l00195">makeProcess()</a>.</p>

</div>
</div>
<a class="anchor" id="a638ec8a4db7ace29c62e773395b63d36"></a><!-- doxytag: member="ldmx::ConfigurePython::keepRules_" ref="a638ec8a4db7ace29c62e773395b63d36" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::string&gt; <a class="el" href="classldmx_1_1ConfigurePython.html#a638ec8a4db7ace29c62e773395b63d36">ldmx::ConfigurePython::keepRules_</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>List of rules for keeping and dropping data products, if provided in python file. </p>

<p>Definition at line <a class="el" href="ConfigurePython_8h_source.html#l00066">66</a> of file <a class="el" href="ConfigurePython_8h_source.html">ConfigurePython.h</a>.</p>

<p>Referenced by <a class="el" href="ConfigurePython_8cxx_source.html#l00034">ConfigurePython()</a>, and <a class="el" href="ConfigurePython_8cxx_source.html#l00195">makeProcess()</a>.</p>

</div>
</div>
<a class="anchor" id="ac92502918c7289b51e9189f2077ca7c5"></a><!-- doxytag: member="ldmx::ConfigurePython::libraries_" ref="ac92502918c7289b51e9189f2077ca7c5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::string&gt; <a class="el" href="classldmx_1_1ConfigurePython.html#ac92502918c7289b51e9189f2077ca7c5">ldmx::ConfigurePython::libraries_</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>List of rules for shared libraries to load, if provided in python file. </p>

<p>Definition at line <a class="el" href="ConfigurePython_8h_source.html#l00068">68</a> of file <a class="el" href="ConfigurePython_8h_source.html">ConfigurePython.h</a>.</p>

<p>Referenced by <a class="el" href="ConfigurePython_8cxx_source.html#l00034">ConfigurePython()</a>, and <a class="el" href="ConfigurePython_8cxx_source.html#l00195">makeProcess()</a>.</p>

</div>
</div>
<a class="anchor" id="a9ec35dcf8f1908874a1b784697b250c6"></a><!-- doxytag: member="ldmx::ConfigurePython::outputFiles_" ref="a9ec35dcf8f1908874a1b784697b250c6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::string&gt; <a class="el" href="classldmx_1_1ConfigurePython.html#a9ec35dcf8f1908874a1b784697b250c6">ldmx::ConfigurePython::outputFiles_</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>List of rules for output ROOT file names, if provided in python file. </p>

<p>Definition at line <a class="el" href="ConfigurePython_8h_source.html#l00070">70</a> of file <a class="el" href="ConfigurePython_8h_source.html">ConfigurePython.h</a>.</p>

<p>Referenced by <a class="el" href="ConfigurePython_8cxx_source.html#l00034">ConfigurePython()</a>, and <a class="el" href="ConfigurePython_8cxx_source.html#l00195">makeProcess()</a>.</p>

</div>
</div>
<a class="anchor" id="acc7e183a3417d290890d47476ab50aa8"></a><!-- doxytag: member="ldmx::ConfigurePython::passname_" ref="acc7e183a3417d290890d47476ab50aa8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string <a class="el" href="classldmx_1_1ConfigurePython.html#acc7e183a3417d290890d47476ab50aa8">ldmx::ConfigurePython::passname_</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The label for this processing pass. </p>

<p>Definition at line <a class="el" href="ConfigurePython_8h_source.html#l00054">54</a> of file <a class="el" href="ConfigurePython_8h_source.html">ConfigurePython.h</a>.</p>

<p>Referenced by <a class="el" href="ConfigurePython_8cxx_source.html#l00034">ConfigurePython()</a>, and <a class="el" href="ConfigurePython_8cxx_source.html#l00195">makeProcess()</a>.</p>

</div>
</div>
<a class="anchor" id="a448506b08fdb4551c0051250d28f6127"></a><!-- doxytag: member="ldmx::ConfigurePython::sequence_" ref="a448506b08fdb4551c0051250d28f6127" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="structldmx_1_1ConfigurePython_1_1ProcessorInfo.html">ProcessorInfo</a>&gt; <a class="el" href="classldmx_1_1ConfigurePython.html#a448506b08fdb4551c0051250d28f6127">ldmx::ConfigurePython::sequence_</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The sequence of <a class="el" href="classldmx_1_1EventProcessor.html" title="Base class for all event processing components.">EventProcessor</a> objects to be executed in order. </p>

<p>Definition at line <a class="el" href="ConfigurePython_8h_source.html#l00085">85</a> of file <a class="el" href="ConfigurePython_8h_source.html">ConfigurePython.h</a>.</p>

<p>Referenced by <a class="el" href="ConfigurePython_8cxx_source.html#l00034">ConfigurePython()</a>, and <a class="el" href="ConfigurePython_8cxx_source.html#l00195">makeProcess()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>Framework/include/Framework/<a class="el" href="ConfigurePython_8h_source.html">ConfigurePython.h</a></li>
<li>Framework/src/<a class="el" href="ConfigurePython_8cxx_source.html">ConfigurePython.cxx</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 7 Jul 2017 for LDMX Software by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
